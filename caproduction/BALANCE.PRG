开始日期=CTOD('')
结束日期=CTOD('')
SET TALK OFF
SET SAFETY OFF

*生成月初库存,月末库存,生产出库,销售出库,实际库存
*We need the following files: 
* BEGIN.DBF(0602.DBF)[改成E:\管理文件\成本预算\200603\0603] /END.DBF(CASTOCK.DBF)/SALE.DBF(FROM THE ACCOUNT)/CATRACK.DBF
* CREAT SUBDIRECTORY SUCH AS E:\管理文件\成本预算\200604\0604
*月初库存由上月报表(0602)月末库存得出
*月末库存=月初库存+本月入库-生产出库
*实际库存由CASTOCK中QTY得出
*盘点数量应与本月的月末库存数量一致
*生产出库=销售出库
*月末库存=实际库存
INPUT '      开始日期=' TO 开始日期
?'                                '
INPUT '      结束日期=' TO 结束日期
?'                                '
INPUT '      请输入本月月初库存表(上月月末库存表含文件路径及名称):' TO XX
?'                                '
INPUT '      请输入本月月末库存表(文件路径及名称):' TO YY
?'                                '

IF 结束日期<={2006/10/26}

**USE E:\管理文件\成本预算\200603\0603
USE &XX
COPY TO E:\GLWJ\CHBYS\BEGIN 

USE E:\GLWJ\CHBYS\BEGIN
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\BEGIN.CDX
TOTAL ON P_NO TO E:\GLWJ\CHBYS\TBEGIN FIELDS 月末库存
CLOSE ALL

USE C:\DONGGUAN\STOCK\CASTOCK
COPY TO E:\GLWJ\CHBYS\END
USE E:\GLWJ\CHBYS\END
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\END.CDX
TOTAL ON P_NO TO E:\GLWJ\CHBYS\TEND FIELDS QTY
CLOSE ALL
USE E:\GLWJ\CHBYS\SALE
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\SALE.CDX
TOTAL ON P_NO TO E:\GLWJ\CHBYS\TSALE FIELDS DELIVE_QTY
CLOSE ALL
USE C:\DONGGUAN\CATRACK 
COPY TO E:\GLWJ\CHBYS\RUKU FOR INSPE_DATE>=开始日期 AND INSPE_DATE<=结束日期
USE E:\GLWJ\CHBYS\RUKU
INDEX ON p_no TAG P_no ADDITIVE
TOTAL ON p_no TO E:\GLWJ\CHBYS\本月入库 FIELDS INSPE_QTY
CLOSE ALL
USE C:\DONGGUAN\CATRACK 
COPY TO E:\GLWJ\CHBYS\CHUKU FOR ASN_SHIP>=开始日期 AND ASN_SHIP<=结束日期 AND OD_MEMO#'上海通知报废'
*****************************AND OD_MEMO#'上海通知报废'

USE E:\GLWJ\CHBYS\CHUKU
INDEX ON p_no TAG P_no ADDITIVE
TOTAL ON p_no TO E:\GLWJ\CHBYS\生产出库 FIELDS DELIVE_QTY
CLOSE ALL
USE E:\GLWJ\CHBYS\balance.dbf EXCLUSIVE
ZAP
APPE FROM E:\GLWJ\CHBYS\TBEGIN
CLOSE ALL
USE E:\GLWJ\CHBYS\balance.dbf EXCLUSIVE
APPE FROM E:\GLWJ\CHBYS\本月入库
CLOSE ALL
USE E:\GLWJ\CHBYS\balance.dbf EXCLUSIVE
APPE FROM E:\GLWJ\CHBYS\生产出库
CLOSE ALL
USE E:\GLWJ\CHBYS\balance.dbf EXCLUSIVE
APPE FROM E:\GLWJ\CHBYS\TEND
CLOSE ALL
USE E:\GLWJ\CHBYS\balance.dbf EXCLUSIVE
APPE FROM E:\GLWJ\CHBYS\TSALE
CLOSE ALL
USE E:\GLWJ\CHBYS\balance.dbf EXCLUSIVE
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\BALANCE.CDX
TOTAL ON P_NO TO E:\GLWJ\CHBYS\TBALANCE
CLOSE ALL
SELE 2
USE E:\GLWJ\CHBYS\TBEGIN
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\TBEGIN.CDX
SELE 1
USE E:\GLWJ\CHBYS\TBALANCE.dbf EXCLUSIVE
SET RELATION TO TBALANCE.p_no INTO TBEGIN ADDITIVE
REPL ALL 月初库存 WITH B->月末库存
CLOSE ALL
SELE 2
USE E:\GLWJ\CHBYS\TEND
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\TEND.CDX
SELE 1
USE E:\GLWJ\CHBYS\TBALANCE.dbf EXCLUSIVE
SET RELATION TO TBALANCE.p_no INTO TEND ADDITIVE
REPL ALL 实际库存 WITH B->QTY
CLOSE ALL
SELE 2
USE E:\GLWJ\CHBYS\本月入库
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\本月入库.CDX
SELE 1
USE E:\GLWJ\CHBYS\TBALANCE.dbf EXCLUSIVE
SET RELATION TO TBALANCE.p_no INTO 本月入库 ADDITIVE
REPL ALL 本月入库 WITH B->INSPE_QTY
CLOSE ALL
SELE 2
USE E:\GLWJ\CHBYS\生产出库
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\生产出库.CDX
SELE 1
USE E:\GLWJ\CHBYS\TBALANCE.dbf EXCLUSIVE
SET RELATION TO TBALANCE.p_no INTO 生产出库 ADDITIVE
REPL ALL 生产出库 WITH B->DELIVE_QTY
CLOSE ALL

*********************************************加通知报废计算
SELE 2
USE C:\DONGGUAN\CATRACK
COPY TO C:\DONGGUAN\CA FOR ASN_SHIP={2006/01/01} AND OD_MEMO='上海通知报废'
USE C:\DONGGUAN\CA
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF C:\DONGGUAN\CA
TOTAL ON P_NO TO C:\DONGGUAN\TCA
USE C:\DONGGUAN\TCA
INDE ON P_NO TAG P_NO ADDITIVE
SET ORDER TO TAG P_NO OF C:\DONGGUAN\TCA
SELE 1
USE E:\GLWJ\CHBYS\TBALANCE.dbf EXCLUSIVE
SET RELATION TO TBALANCE.p_no INTO TCA ADDITIVE
REPL ALL 通知报废 WITH B->DELIVE_QTY 
**************************************************************************************

SELE 2
USE E:\GLWJ\CHBYS\TSALE
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\TSALE.CDX
SELE 1
USE E:\GLWJ\CHBYS\TBALANCE.dbf EXCLUSIVE
SET RELATION TO TBALANCE.p_no INTO TSALE ADDITIVE
REPL ALL 销售出库 WITH B->DELIVE_QTY
REPL ALL 月末库存 WITH 月初库存+本月入库-生产出库-通知报废

*生成所有样带

*SELE 2
*USE E:\GLWJ\CHBYS\BEGIN
*COPY TO E:\GLWJ\CHBYS\BEGSAM FOR 'CAT'$ORDER_NO
*USE E:\GLWJ\CHBYS\BEGSAM
*INDEX ON p_no TAG P_no ADDITIVE
*SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\BEGSAM.CDX
*TOTAL ON P_NO TO E:\GLWJ\CHBYS\TBEGSAM FIELDS QTY
*CLOSE ALL
USE E:\GLWJ\CHBYS\END
COPY TO E:\GLWJ\CHBYS\ENDSAM FOR 'CAT'$ORDER_NO
USE E:\GLWJ\CHBYS\ENDSAM
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\ENDSAM.CDX
TOTAL ON P_NO TO E:\GLWJ\CHBYS\TENDSAM FIELDS QTY
CLOSE ALL
USE E:\GLWJ\CHBYS\SALE
COPY TO E:\GLWJ\CHBYS\SALSAM FOR 'CAT'$ORDER_NO
USE E:\GLWJ\CHBYS\SALSAM
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\SALSAM.CDX
TOTAL ON P_NO TO E:\GLWJ\CHBYS\TSALSAM FIELDS DELIVE_QTY
CLOSE ALL
USE E:\GLWJ\CHBYS\RUKU
COPY TO E:\GLWJ\CHBYS\RUKUSAM FOR 'CAT'$ORDER_NO
USE E:\GLWJ\CHBYS\RUKUSAM
INDEX ON p_no TAG P_no ADDITIVE
TOTAL ON p_no TO E:\GLWJ\CHBYS\TRUKUSAM FIELDS INSPE_QTY
CLOSE ALL
USE E:\GLWJ\CHBYS\CHUKU
COPY TO E:\GLWJ\CHBYS\CHUSAM FOR 'CAT'$ORDER_NO
USE E:\GLWJ\CHBYS\CHUSAM
INDEX ON p_no TAG P_no ADDITIVE
TOTAL ON p_no TO E:\GLWJ\CHBYS\TCHUSAM FIELDS DELIVE_QTY
CLOSE ALL
*SELE 2
*USE E:\GLWJ\CHBYS\TBEGSAM
*INDEX ON p_no TAG P_no ADDITIVE
*SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\TBEGSAM.CDX
*SELE 1
*USE E:\GLWJ\CHBYS\TBALANCE.dbf EXCLUSIVE
*SET RELATION TO TBALANCE.p_no INTO TBEGSAM ADDITIVE
*REPL ALL 月初样带 WITH B->QTY
*CLOSE ALL
SELE 2
USE E:\GLWJ\CHBYS\TENDSAM
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\TENDSAM.CDX
SELE 1
USE E:\GLWJ\CHBYS\TBALANCE.dbf EXCLUSIVE
SET RELATION TO TBALANCE.p_no INTO TENDSAM ADDITIVE
REPL ALL 实际样带 WITH B->QTY
CLOSE ALL
SELE 2
USE E:\GLWJ\CHBYS\TRUKUSAM
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\TRUKUSAM.CDX
SELE 1
USE E:\GLWJ\CHBYS\TBALANCE.dbf EXCLUSIVE
SET RELATION TO TBALANCE.p_no INTO TRUKUSAM ADDITIVE
REPL ALL 入库样带 WITH B->INSPE_QTY
CLOSE ALL
SELE 2
USE E:\GLWJ\CHBYS\TCHUSAM
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\TCHUSAM.CDX
SELE 1
USE E:\GLWJ\CHBYS\TBALANCE.dbf EXCLUSIVE
SET RELATION TO TBALANCE.p_no INTO TCHUSAM ADDITIVE
REPL ALL 出库样带 WITH B->DELIVE_QTY
CLOSE ALL
SELE 2
USE E:\GLWJ\CHBYS\TSALSAM
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF E:\GLWJ\CHBYS\TSALSAM.CDX
SELE 1
USE E:\GLWJ\CHBYS\TBALANCE.dbf EXCLUSIVE
SET RELATION TO TBALANCE.p_no INTO TSALSAM ADDITIVE
REPL ALL 销售样带 WITH B->DELIVE_QTY

REPL ALL 月初产品 WITH 月初库存-月初样带
REPL ALL 入库产品 WITH 本月入库-入库样带
REPL ALL 出库产品 WITH 生产出库-出库样带
REPL ALL 销售产品 WITH 销售出库-销售样带
REPL ALL 月末产品 WITH 月末库存-月末样带
REPL ALL 实际产品 WITH 实际库存-实际样带
CLOSE ALL

*添加产品信息

SELE 2
USE C:\DONGGUAN\CATRACK
INDEX ON p_no TAG P_no ADDITIVE
SET ORDER TO TAG P_no OF C:\DONGGUAN\CATRACK
SELE 1
USE E:\GLWJ\CHBYS\TBALANCE.dbf EXCLUSIVE
SET RELATION TO TBALANCE.p_no INTO CATRACK ADDITIVE
REPL ALL CAP_CODE WITH B->CAP_CODE
REPL ALL WIDE WITH B->WIDE
REPL ALL LENTH WITH B->LENTH
REPL ALL GRIT WITH B->GRIT
REPL ALL U_M2 WITH WIDE*LENTH*0.000001
REPL ALL GROUP_NO WITH B->GROUP_NO
DELE ALL FOR P_NO=' '
PACK
DELE ALL FOR CAP_CODE=' '
PACK

*将目标文件存盘

COPY TO &YY

ELSE
CLEAR
?'   程序已过期!!'
CANCEL
ENDIF

SET TALK ON
SET SAFETY ON
CLOSE ALL

